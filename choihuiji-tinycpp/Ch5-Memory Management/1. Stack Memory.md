## 프로세스 주소 공간
프로세스 주소 공간은 다음과 같은 순서로 저장된다.
1. Code, 텍스트(Text) 섹션
	- 주소 공간의 가장 낮은 부분에 위치
	- 프로그램의 기계어 명령어들이 저장
2. 데이터(Data) 섹션
	- 초기화된 변수 영역
	- 초기화되지 않은 변수 영역(BSS : Block Started By Symbol)
	- 전역, 정적 변수가 저장됨
3. 힙(Heap) 섹션
	- 동적 메모리 할당 영역
	- new 또는 malloc 같은 함수를 통해 메모리가 할당
	- 프로그램이 실행되는 동안 필요에 따라 힙의 크기가 증가하거나 감소할 수 있음
4. 스택(Stack) 섹션
	- 함수 호출과 관련된 정보(매개변수, 지역 변수, 반환 주소 등)를 저장
	- 함수 호출 시 마다 스택 프레임이 생성, 함수가 반환될 때 해당 프레임이 제거
---
## Data와 BSS 세그먼트
```
int data[] = {1, 2}; // Data 세그먼트

int big_data[1000000] = {}; // BSS 세그먼트
							// 0으로 초기화

int main() {
	int A[] = {1, 2, 3}; // 스택 메모리
}
```
- Data와 BSS 영역은 스택 메모리보다 일반적으로 크기가 크지만 접근 속도는 스택 메모리보다 느릴 수 있음
---
## Stack과 Heap 비교

|        | Stack                                | Heap                                                  |
| ------ | ------------------------------------ | ----------------------------------------------------- |
| 메모리 구조 | - 연속적인 메모리 구조<br>- 후입선출(LIFO)        | - 각 할당 내에서는 연속적<br>- 할당 사이에는 조각날 수 있음<br>(가상 메모리에 의존) |
| 최대 크기  | 상대적으로 작음<br>(리눅스에서는 8MB, 윈도우에서는 1MB) | 시스템 메모리 전체로 확장될 수 있음                                  |
| 초과 시   | 프로그램은 함수 진입 시점에 크래시가 발생, 디버그 하기 어려움  | 예외가 발생하거나, 널 포인터(nullptr) 반환                          |
| 할당 시기  | 컴파일 시간에 할당                           | 런타임에 할당<br>                                           |
| 지역성    | 높은 지역성, 메모리에 접근 속도 빠름                | 낮은 지역성, 메모리에 접근 속도 상대적으로 느림                           |
| 스레드 관점 | 각 스레드는 자신만의 스택을 가짐                   | 모든 스레드 사이에서 공유                                        |

---
## Stack Memory
- 지역 변수는 스택 메모리 또는 CPU register에 저장됨
```
int x = 3; // 스택에 저장되지 않음 (Data 세그먼트)

struct A {
	int k; // A의 인스턴스가 어디에 위치하느냐에 따라 달라짐
};

int main() {
	int y = 3; // 스택
	char z[] = "abc"; // 스택
	A a; // 스택 (k 또한)
	
	void* ptr = malloc(4); // "ptr" 변수는 스택에 저장됨
}
```
- 스택 메모리는 빠른 접근 속도를 제공하지만, 크기가 제한적임

- 스택에 있는 모든 객체는 해당 범위를 벗어나면 유효하지 않음
```
int* f() {
    int array[3] = {1, 2, 3}; // 지역 배열 생성
    return array; // 지역 배열의 주소를 반환
} // 함수가 끝나면 array는 스코프를 벗어나 유효하지 않음

int* ptr = f(); // f()에서 반환된 주소를 ptr에 할당
cout << ptr[0]; // 불법 메모리 접근!! array는 더 이상 유효하지 않음
```

```
void g(bool x) {
    const char* str = "abc"; // str은 "abc" 문자열 리터럴을 가리킴
    if (x) {
        char xyz[] = "xyz"; // 지역 배열 생성
        str = xyz; // str을 xyz 배열로 업데이트
    } // if 블록이 끝나면 xyz는 스코프를 벗어나 유효하지 않음
    cout << str; // x가 true일 경우, str을 통한 접근은 불법 메모리 접근을 발생시킬 수 있음
}
```

---
## 스택 메모리에 저장되는 데이터 유형
- 로컬 변수
	- 함수 내에서 선언된 변수들
- 함수 인자
	- 함수를 호출할 때 전달되는 인자들도 스택 메모리에 저장
- 반환 주소
	- 함수가 다른 함수를 호출할 때, 현재 실행중인 위치의 주소(반환 주소)가 스택에 저장
- 컴파일러 임시 변수
	- 컴파일러 연산을 위한 임시 변수가 스택에 저장
- 인터럽트 컨텍스트
	- 현재의 실행 컨텍스트를 저장
---
## 참고
https://st-lab.tistory.com/198 - 메모리 구조