# Day-36

## volatile Keyword

### volatile

- volatile은 포인터나 객체와 관련된 공격적인 메모리 최적화를 피하기 위한 컴파일러의 힌트
- 사용 사례
    - Low-level 프로그래밍 : 드라이버 개발, 어셈블리와의 상호 작용 등
        - 특정 메모리 위치에 강제 쓰기
    - 멀티스레드 프로그램 : 스레드/프로세스 간 통신을 위해 공유되는 변수
        - 최적화하지 않고 변수 업데이트 지연
    - 벤치마킹 : 일부 작업을 최적화하지 않아도 되는 경우
- 참고
    - volatile 읽기/쓰기는 non-volatile 읽기/쓰기에 대해 순서를 변경할 수 있음
- 다음 코드는 -03(전체 최적화)를 사용하고 volatile 없이 컴파일하면 정상적으로 작동함
    
```cpp
volatile int* ptr = new int[1];     // 실제 할당 크기는 일반적으로
int pos = 128 * 1024 / sizeof(int); // 128KB로 훨씬 큼
ptr[pos] = 4;                       // segfault
```
    

### volatile 추가

- volatile로 선언된 변수는 외부적인 요인으로 그 값이 언제든지 바뀔 수 있음을 뜻함
- 컴파일러는 volatile 선언된 변수에 대해서는 최적화를 수행하지 않음
- volatile 변수를 참조할 경우 레지스터에 로드된 값을 사용하지 않고 매번 메모리를 참조함
