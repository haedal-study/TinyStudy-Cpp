# [Common Errors]

## 공통 오류 1 
- 상황: 헤더 파일과 include문 이전에 매크로를 정의함
- 이렇게 하면 매크로가 사용되기 전에 이미 정의되어 있어야 하므로 예상치 못한 결과를 초리할 수 있음
~~~cpp
# include <iostream>
# define value // 매우 위험함!!
# include "big_lib.hpp"
int main() {
std::cout << f(4); // 7을 출력해야 하지만 항상 3을 출력함
}
~~~
“big_lib.hpp”:
~~~cpp
int f(int value) { // 'value'가 사라짐
return value + 3;
} 
~~~

## 공통 오류 2
- 상황: 매크로를 사용하여 조건부 컴파일할 때 매크로의 정의를 잊음
- 이는 매크로를 사용하는 코드가 의도한대로 동작하지 않을 수 있음
~~~cpp
// #include "macro_definition.hpp" // ENABLE_DEBUG를 정의하는 헤더를 추가하는 것을 잊음
# if defined(ENABLE_DEBUG)
void f(int v) { cout << v << endl; return v * 3; }
# else
void f(int v) { return v * 3; }
# endif
# if ENABLE_DEBUG // 0 또는 1로 평가됨
void f(int v) { cout << v << endl; return v * 3; }
# else
void f(int v) { return v * 3; }
# endif
~~~

## 공통 오류 3
- 상황: 매크로를 정의할 때 괄호를 사용하지 않음
- 이로 인해 의도치 않은 동작이 발생할 수 있음
~~~cpp
# include <iostream>
# define SUB1(a, b) a - b // 잘못됨
# define SUB2(a, b) (a - b) // 잘못됨
# define SUB3(a, b) ((a) - (b)) // 올바름
int main() {
std::cout << (5 * SUB1(2, 1)); // 5가 아니라 9 출력
std::cout << SUB2(3 + 3, 2 + 2); // 2가 아니라 6 출력
std::cout << SUB3(3 + 3, 2 + 2); // 2 출력
}
~~~

## 공통 오류 4
- 상황: 매크로를 다중 라인으로 정의할 때 중괄호를 빠뜨림
- 이렇게 되면 다중 라인 매크로의 일부가 아닌 코드가 의도하지 않은 위치에서 실행될 수 있음
~~~cpp
1: # include <iostream>
2:
3: # define F(a) { \
4: ... \
5: ... \
6: return v;
7:
8: int main() {
9: F(3); // 9번 라인에서 컴파일 오류 발생
10: }
~~~

## 공통 오류 5
- 상황: 매크로의 평가 시 의도치 않은 부작용이 발생함
- 이로 인해 코드가 예상과 다르게 동작할 수 있음
~~~cpp
# if defined(DEBUG)
# define CHECK(EXPR) // EXPR을 사용하여 작업 수행
void check(bool b) { /* b를 사용하여 작업 수행 */ }
# else
# define CHECK(EXPR) // 아무 작업도 수행하지 않음
void check(bool) {} // 아무 작업도 수행하지 않음
# endif
bool f() { /* boolean 값을 반환 */ }
check( f() )
CHECK( f() ) // <- 여기서 문제 발생
~~~

## 공통 오류 6
- 상황: 매크로가 스코프를 가지지 않음
- 매크로는 전역적으로 적용되며, 적절히 사용하지 않으면 다른 코드에 영향을 줄 수 있음
~~~cpp
# include <iostream>
# include <nuclear_explosion.hpp>
# define NUCLEAR_EXPLOSION \ // {
std::cout << "핵 폭발 시작"; \
nuclear_explosion();
// }
int main() {
bool never_happen = false;
if (never_happen)
NUCLEAR_EXPLOSION
} // 폭발!! A
두 번째 줄이 실행됨
~~~

## 공통 오류 7
- 상황: 매크로를 재정의하거나 여러 번 정의함
- 이렇게 하면 컴파일러가 경고를 발생시키고 의도치 않은 동작을 초래할 수 있음
~~~cpp
# include <iostream>
void f() {
# define value 4
std::cout << value;
}
int main() {
f(); // 4
std::cout << value; // 4
# define value 3
f(); // 4
std::cout << value; // 3
}
~~~

## 공통 오류 8
- 상황: 매크로가 부작용을 일으킴
- 매크로는 코드의 다른 부분에 영향을 줄 수 있으며, 의도하지 않은 결과를 초래할 수 있음
~~~cpp
# define MIN(a, b) ((a) < (b) ? (a) : (b))
int main() {
    int array1[] = { 1, 5, 2 };
    int array2[] = { 6, 3, 4 };
    int i = 0;
    int j = 0;
    int v1 = MIN(array1[i++], array2[j++]); // v1 = 5
    int v2 = MIN(array1[i++], array2[j++]); // 정의되지 않는 동작
}
~~~

## 공통 오류 9
- 매크로가 정의되지 않은 동작을 가짐
- 이 경우 매크로를 사용하는 코드가 예기치 않은 결과를 초래할 수 있음
~~~cpp
# define MY_MACRO defined(EXTERNAL_MACRO)
# if MY_MACRO
# define MY_VALUE 1
# else
# define MY_VALUE 0
# endif
int f() { return MY_VALUE; } // 정의되지 않는 동작
~~~
