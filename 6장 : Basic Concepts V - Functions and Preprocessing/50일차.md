# [Source Location Macros]

## 전처리기가 필요한 경우
- 조건부 컴파일
  - 다른 아키텍처, 컴파일러 기능 등에 따라 컴파일하는 경우
- 다른 언어를 혼합하여 사용하는 경우
  - 코드 생성 (ex. 어셈블리어)
- 복잡한 이름을 교체하는 경우
  - 템플릿 프로그래밍과 같은 경우
- 그 외의 경우
  - 상수 값과 함수에 const와 constexpr를 사용하는 것이 좋음
  - ex. C++11에서의 전역 범위에서만 const int로 SIZE를 정의하거나, 
매크로로 정의되어 있는 SUB 함수를 constexpr 함수로 대체할 수 있음

## 소스 위치 매크로
- __LINE__ : 컴파일 중이 소스 코드 파일의 현재 줄을 나타내는 정수 값
- __FILE__ : 컴파일 중인 소스 파일의 이름을 포함하는 문자열 리터럴
- __FUNCTION__ (비표준, gcc, clang) : ‘매크로 범위’의 함수 이름을 포함하는 문자열 리터럴
- __PRETTY_FUNCTION__ (비표준, gcc, clang) : ‘매크로 범위’의 함수의 전체 서명을 포함하는 문자열 리터럴
- __func__ (C++11 키워드) : ‘매크로 범위’의 함수 이름을 포함하는 문자열

~~~cpp
// source.cpp 파일 내용
#include <iostream>

void f(int p) {
    std::cout << __FILE__ << ":" << __LINE__; // 출력: 'source.cpp:4'
    std::cout << __FUNCTION__; // 출력: 'f'
    std::cout << __func__; // 출력: 'f'
}

template<typename T>
float g(T p) {
    std::cout << __PRETTY_FUNCTION__; // 출력: 'float g(T) [T = int]'
    return 0.0f;
}

void g1() { 
    g(3); 
}
~~~

- C++20은 매크로 기반 접근 방식을 대체하기 위한 소스 위치 유틸리티를 제공함
  - current() : 현재 소스 위치 정보를 반환하는 정적 멤버 함수임
  - line() : 현재 소스 코드의 라인 번호를 반환함
  - column() : 현재 소스 코드의 열 번호를 반환함
  - file_name() : 현재 파일의 이름을 반환함
  - function_name() : 현재 함수의 이름을 반환함

~~~cpp
#include <source_location>
#include <iostream>

void f(std::source_location s = std::source_location::current()) {
    std::cout << "function: " << s.function_name() << ", line " << s.line();
}

int main() {
    f(); // 출력: "function: f, line 6"
    return 0;
}
~~~
