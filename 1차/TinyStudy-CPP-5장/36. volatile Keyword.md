### `volatile` 키워드
---

* `volatile`를 붙인 포인터나 객체의 읽기/쓰기에 대해 컴파일러의 최적화를 적용시키지 않도록 지시하는 키워드이다.
* 변수가 외부 요인에 의해 변경될 수 있을 때 주로 사용한다. 

* 사용되는 곳
	1. 저수준 프로그래밍 : 드라이버 개발이나 어셈블리 활용등에 쓰인다. (ex. 메모리의 특정 위치에 쓰기를 수행)
	2. 멀티스레드 프로그램 : 통신을 위해 스레드/프로세스 간 공유되는 변수에 쓰임. (최적화를 하지 않고 변수 업데이트를 지연시킨다.)
	3. 벤치마킹 : 최적화하지 말아야 하는 몇 작업들에 쓰인다.

* `volatile` 의 읽기/쓰기는 non-volatile 읽기/쓰기와 같이 재배치 될 수 있다.
```cpp
// 재배치
int a = 1;
int b = 1;
int c = 1;
// 예를 들어, 위와 같은 순서로 선언된 변수가 컴파일러 최적화에 의해 다른 순서로 선언될 수도 있는 것이다.
// 이런 경우, 변수를 다른 스레드나 비동기적으로 실행되는 경우, 오류를 발생시킬 수 있다.
```

* 다음은 전체 최적화(`-O3`)를 사용하고, `volatile` 키워드를 제거하면 올바르게 작동하는 코드이다.
```cpp
volatile int* ptr = new int[1]; // 실제 할당되는 크기는 더 크다.(일반적으로 128KB)
int pos = 128 * 1024 / sizeof(int);
ptr[pos] = 4; // 세그먼테이션 오류
```
.

참고자료
[서광열 블로그 :: C/C++ volatile 키워드 (tistory.com)](https://skyul.tistory.com/337)



