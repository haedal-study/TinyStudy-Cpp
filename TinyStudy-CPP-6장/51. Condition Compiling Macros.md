
### Condition Compiling Macro
---
- 컴파일 환경을 가져오는 매크로를 사용해 조건부 컴파일을 할 수 있다.

- `__cplusplus` : C/C++ 버전을 가져온다. 
	- MSVC에서 이를 사용하기 위해서는 `/Zc:__cplusplus` 컴파일러 옵션을 추가해줘야 한다.
	- 추가하지 않으면 기본값인 `199711L`로 나타내진다.

- 사용 중인 컴파일러를 가져오는 매크로
	- `ifdef(__GNUG__)` : gcc/g++같은 GNU 컴파일러를 사용 중인지 확인한다. 
	- `ifdef(__clang__)` : clang 컴파일러를 사용 중인지 확인한다.
	- `ifdef(_MSC_VER)` : MSVC 컴파일러를 사용 중인지 확인한다.


```cpp
int main() {
	// /Zc:__cplusplus 규칙을 추가해야 함.'프로젝트 속성->C/C++->명령줄'에 추가
#if __cplusplus == 202002L
	std::cout << "C++20" << "\n";
#else
	std::cout << "C++??" << "\n";
#endif

#if defined(__GNUC__)
	std::cout << "this is gcc" << "\n";
#elif defined(__clang__)
	std::cout << "this is clang" << "\n";
#elif defined(_MSC_VER)
	std::cout << "this is MSVC" << "\n";
#else
	std::cout << "What is this?" << "\n";
#endif
}

// print
// 'C++20
//  this is MSVC'
```


- 운영체제에 따라 조건부로 컴파일 되도록 할 수도 있다.
```cpp
int main() {
#if defined(_WIN64)
	std::cout << "OS : Win-64" << "\n";
#elif defined(__linux__)
	std::cout << "OS : Linux" << "\n";
#elif defined(__APPLE__)
	std::cout << "OS : Mac OS" << "\n";
#elif defined(__MINGW32__)
	std::cout << "OS : MINGW-32" << "\n";
#endif
}
```


### Other Macros
---
- `__DATE__` : 컴파일이 진행된 시점의 날짜가 "MMM DD YYYY" 형태로 나타내어진다.
- `__TIME__` : 컴파일이 진행된 시점의 시간이 나타내어진다.
```cpp
int main() {
	std::cout << __DATE__ << "\n"; // 'April 26 2024'
	std::cout << __TIME__ << "\n"; // '10:06:24'
}
```


### Feature Testing Macro
---
- C++17에서는 `__has_include` 매크로를 사용해서 특정 파일이 인클루드 됐는지 검사할 수 있다.
	- 해당 파일을 인클루드 했다면 1을 리턴한다.
```cpp
#if __has_include(<iostream>)
#    include <iostream>
#endif
```

- C++20에서는 특정 키워드를 사용할 수 있는지 평가하는 매크로가 있다.
```cpp
#if __cpp_constexpr
constexpr int square(int x) {return x*x;}
#endif
```


참고자료

[/Zc:__cplusplus (업데이트된 __cplusplus 매크로 사용) | Microsoft Learn](https://learn.microsoft.com/ko-kr/cpp/build/reference/zc-cplusplus?view=msvc-170)
