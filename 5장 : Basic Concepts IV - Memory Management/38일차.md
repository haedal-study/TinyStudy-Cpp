# [Type Punning]

## 타입 퍼닝

프로그래밍 언어의 유형 시스템을 우회하여 형식 변환을 통해 어려운 또는 불가능한 효과를 얻는 것을 말함    
이는 일반적으로 메모리의 일부를 다른 유형으로 해석하고자 할 때 사용됨   
    
**그러나** C++의 엄격한 에일리어싱 규칙을 위반할 수 있으며 이는 정의되지 않은 동작으로 이어질 수 있음   
   
예를 들어, 부동 소수점 수를 절댓값으로 변환하는 함수일 경우 다음과 같이 일반적인 구현이 가능함    
   
~~~cpp
float abs(float x) {
    return (x < 0.0f) ? -x : x;
}
~~~
   
그러나 이러한 방식은 최적화가 부족할 수 있음    
대신 다음과 같이 타입 퍼닝을 이용하여 직접 최적화할 수 있음   
   
~~~cpp
float abs(float x) {
    unsigned uvalue = reinterpret_cast<unsigned&>(x);
    unsigned tmp = uvalue & 0x7FFFFFFF;
    return reinterpret_cast<float&>(tmp);
}
~~~
이러한 최적화는 하드웨어에 따라 다르지만, 잘못된 컴파일러 최적화나 예상치 못한 동작을 초래할 수 있음    
이에 대한 경고는 -Wstrict-aliasing 컴파일러 플래그를 통해 제공될 수 있음   
   
C++20에서는 std::bit_cast 함수가 소개되어 이러한 형태의 형변환을 안전하게 수행할 수 는데,     
이는 reinterpret_cast를 대체하는 더 안전한 형변환 방법을 제공함   
