
### `sizeof` 연산자
---

* 컴파일 타임에 변수나 자료형의 크기를 byte 단위로 알려준다.

* 특징
	* `sizeof`의 리턴 타입은 `size_t`이다.
	* `sizeof(아무거나)`는 절대 0을 리턴하지 않는다. (gcc에서는 배열의 크기가 0이면 0을 리턴한다.)
	* `sizeof(char)`은 항상 1이다.
	* 구조체에 적용할 때에는 내부 패딩을 고려한다. 
	* 참조에 적용할 때에는 참조된 타입의 크기를 반환한다.
	* 불완전한 형식*(incomplete type)을 넣은 `sizeof`는 컴파일 에러가 난다.
	* bit field 멤버를 넣은 `sizeof`는 컴파일 에러가 난다.

*불완전한 형식 : 식별자는 알고 있지만, 식별자의 크기가 아직 알려지지 않은 형식. ex. void, 크기를 지정하지 않은 배열, 맴버를 지정하지 않은 구조체 등*

#### `sizeof`-포인터

* 운영체제에 맞게 포인터의 사이즈가 정해진다.
```cpp
sizeof(int); // 4 bytes
sizeof(int*); // 8 bytes (64-bit 운영체제)
// 32-bit 운영체제에서는 4 bytes
```

```cpp
void f(int array[]) { // 배열의 크기가 정해져있지 않아서 위험함.
	cout << sizeof(array);
}

int array1[10];
int* array2 = new int[10];
cout << sizeof(array1); // 4 * 10 = 40 bytes (배열의 크기)
cout << sizeof(array2); // sizeof(int*) = 8 bytes (배열을 가리키는 포인터의 크기)
f(array1); // 64-bit 운영체제에서 8 bytes
```

#### `sizeof`-`struct`

* 패딩(padding) : 구조체나 클래스에 CPU가 메모리 공간에 효율적으로 접근할 수 있도록 공간을 확보하는 것.
* 64-bit 운영체제의 경우, CPU는 8byte 단위로 메모리를 읽는데, 구조체의 멤버들이 연속적으로 메모리에 나열되어 있다면 8 byte 이하의 데이터를 읽더라도 불필요하게 여러번 읽어야 하는 경우가 발생하는데, 이를 방지할 수 있다.

* 구조체의 크기를 읽을 때는 패딩되는 값을 포함해서 읽게 된다.
* 패딩 크기를 줄이기 위해 크기가 큰 맴버부터 선언을 하자.

```cpp
struct B { 
	int x; // 4 byte 할당 
	char y; // 1 byte 할당 + 1 byte 패딩 
	short z; // 2 byte 할당
}; 
sizeof(B); // 8 bytes

struct C { 
	short z; // 2 byte 할당 + 2 byte 패딩 
	int x; // 4-byte 할당 
	char y; // 1 byte 할당 + 3 byte 패딩
}; 
sizeof(C); // 12 bytes
```

#### `sizeof`-참조와 배열

* 참조 변수의 경우, 참조된 데이터의 크기를 반환한다.
```cpp
char a = ' ';
cout << sizeof(a); // print 1
```

* 크기가 0인 배열이나, 크기가 0인 구조체의 배열은 1을 반환한다. 
```cpp
struct A{};
sizeof(A); // 1 반환

A array1[10];
sizeof(array1); // 1 반환
```

#### sizeof and Size of a Byte

* C++은 명시적으로 바이트의 크기를 정의하지 않는다.

읽어 볼 것
[c++ - Exotic architectures the standards committees care about - Stack Overflow](https://stackoverflow.com/questions/6971886/exotic-architectures-the-standards-committees-care-about)

참고자료
[Incomplete Types | Microsoft Learn](https://learn.microsoft.com/en-us/cpp/c-language/incomplete-types?view=msvc-170)
