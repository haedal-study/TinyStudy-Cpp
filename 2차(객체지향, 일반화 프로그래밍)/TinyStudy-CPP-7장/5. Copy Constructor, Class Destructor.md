
### Copy Constructor
---

- 복사 생성자(Copy Constructor)는 객체를 다른 객체의 깊은 복사(deep copy)를 통해 생성할 때 사용되는 생성자이다.
- `T(const T&)`와 같은 형식으로 사용한다.

- 특징
	- 모든 클래스에는 암시적, 명시적 혹은 삭제된 복사 생성자가 있다.
	- 복사 생성자는 암시적으로 부모 클래스의 기본 생성자를 호출한다. (사용자 지정 복사 생성자인 경우에도 호출한다.)
	- 복사 생성자와 `=`연산자 호출은 다르다.

```cpp
class A {
public:
	A() { cout << "A default "; }
	A(const A&) { cout << "A copy "; }
};

class B : public A {
public:
	B() { cout << "B default "; }
	B(const B&) { cout << "B copy "; }
};


B b1; // print "A default B default"
B b2{ b1 }; // print "A default B copy"
```

```cpp
MyStruct x;
MyStruct y{x} // 복사 생성자 호출
y = x; // operator= 호출. 복사 초기화 라고 함.
```

- 복사 생성자가 사용되는 경우
	- 객체를 이미 존재하는 (같은 타입의) 다른 객체로 초기화하고 싶은 경우
	- 함수의 인자로 값 전달을 하고 싶은 경우
	- 함수의 반환값으로 리턴되는 객체를 복사하고 싶은 경우(RVO* 최적화가 적용되면 복사 생성자가 사용되지 않음)

- *RVO(Return Value Optimization) : 함수가 객체를 값으로 반환할 때 발생하는 불필요한 복사 연산을 줄이기 위한 컴파일러 최적화이다. 반환할 객체를 함수 스택에 생성하지 않고 함수를 호출한 함수에서 생성하여 최적화 함.
```cpp
class A {
public:
	A() { cout << "A default "; }
	A(const A&) { cout << "A copy "; }
};

A foo() { return A(); }

A a = foo(); // print "A default"
```
- 위 코드의 예상
	- `foo()` 함수에서 A 객체를 생성 --> 함수가 리턴하면서 임시객체 생성 --> `a` 객체의 복사 생성자로 리턴된 객체 할당.
- RVO 적용
	- `foo()` 함수에서 A 객체를 생성하지 않고, `foo()`를 호출한 함수에서 객체가 생성됨. --> 임시객체 생성X


#### 삭제된 복사 생성자(Deleted Copy Constructor)

- 다음과 같은 경우에 암시적 복사 생성자가 삭제된 것으로 표시된다.
	- 클래스가 비정적 멤버나 부모 클래스의 참조, `const` 타입 멤버를 가질 경우
	- 삭제된 복사 생성자를 갖는 클래스를 멤버 변수로 두거나, 부모로 두는 경우
	- 접근할 수 없는 소멸자를 가진 클래스를 멤버 변수로 두거나 부모로 두는 경우
	- 클래스가 이동 생성자를 가진 경우


### Class Destructor
---

- 소멸자(Destructor)는 객체가 범위를 벗어나거나 `delete`되는 것과 같이 소멸될 때 호출되는 멤버 함수이다.
	- `~T()`로 사용할 수 있다.
	- 모든 클래스는 소멸자를 암시적, 명시적으로 가지고 있다.
	- C++20부터 소멸자에 `constexpr` 키워드를 달 수 있다.

- 목적 : 객체가 소멸될 때 객체가 가진 자원을 해제하도록 하기 위함.

```cpp
struct Array {
	int* arr;
	Array() {
		arr = new int[10];
	}
	constexpr ~Array() { // C++20
		delete[] arr;
	}
};
```

- 소멸자 호출 순서
	- 소멸자는 상속받을 수 없다.
	- 자식 클래스의 소멸자가 먼저 호출되고 그 다음 부모 소멸자가 호출된다.

```cpp
struct A {
	~A() { cout << "A"; }
};
struct B {
	~B() { cout << "B"; }
};
struct C : A {
	B b;
	~C() { cout << "C"; }
};

int main() {
	C b; // print "CBA"
}
```

